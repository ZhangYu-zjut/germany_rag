# Q1 vs Q5 æ€§èƒ½å·®å¼‚æ·±åº¦åˆ†ææŠ¥å‘Š

**é—®é¢˜**: ä¸ºä»€ä¹ˆQ5(9ä¸ªå­é—®é¢˜)åªç”¨32ç§’,è€ŒQ1(10ä¸ªå­é—®é¢˜)ç”¨äº†816ç§’?

**ç­”æ¡ˆ**: **å¹´ä»½æ•°é‡å·®å¼‚** + **ä¸²è¡Œforå¾ªç¯** = æ€§èƒ½çº¿æ€§å¢é•¿

---

## 1. å…³é”®è¯æ®å¯¹æ¯”

### Q1 è¯¦ç»†æ—¶é—´è½´ (10ä¸ªå­é—®é¢˜,10å¹´)

| å­é—®é¢˜ | å¼€å§‹æ—¶é—´ | ç»“æŸæ—¶é—´ | è€—æ—¶(ç§’) | å¹´ä»½æ•° | æ¯å¹´è€—æ—¶ |
|-------|---------|---------|---------|--------|---------|
| 1 | 11:20:50 | 11:22:21 | 91ç§’ | 10å¹´ | 9.1ç§’ |
| 2 | 11:22:21 | 11:23:43 | 82ç§’ | 10å¹´ | 8.2ç§’ |
| 3 | 11:23:43 | 11:25:58 | 135ç§’ | 10å¹´ | 13.5ç§’ |
| 4 | 11:25:58 | 11:28:27 | 149ç§’ | 10å¹´ | 14.9ç§’ |
| 5 | 11:28:27 | 11:30:19 | 112ç§’ | 10å¹´ | 11.2ç§’ |
| 6 | 11:30:19 | 11:31:44 | 85ç§’ | 10å¹´ | 8.5ç§’ |
| 7 | 11:31:44 | 11:33:47 | 123ç§’ | 10å¹´ | 12.3ç§’ |
| 8 | 11:33:47 | 11:33:59 | 12ç§’ | 10å¹´ | 1.2ç§’ |
| 9 | 11:33:59 | 11:34:11 | 12ç§’ | 10å¹´ | 1.2ç§’ |
| 10 | 11:34:11 | 11:34:26 | 15ç§’ | 10å¹´ | 1.5ç§’ |

**æ€»è®¡**: 816ç§’ (10ä¸ªå­é—®é¢˜ Ã— å¹³å‡81.6ç§’)
**å¹³å‡**: æ¯å¹´10.8ç§’ (816ç§’ / 10å­é—®é¢˜ / 10å¹´)

### Q5 è¯¦ç»†æ—¶é—´è½´ (9ä¸ªå­é—®é¢˜,3å¹´)

| å­é—®é¢˜ | å¼€å§‹æ—¶é—´ | ç»“æŸæ—¶é—´ | è€—æ—¶(ç§’) | å¹´ä»½æ•° | æ¯å¹´è€—æ—¶ |
|-------|---------|---------|---------|--------|---------|
| 1 | 11:49:12 | 11:49:16 | 4ç§’ | 3å¹´ | 1.3ç§’ |
| 2 | 11:49:16 | 11:49:17 | 1ç§’ | 3å¹´ | 0.3ç§’ |
| 3 | 11:49:17 | 11:49:21 | 4ç§’ | 3å¹´ | 1.3ç§’ |
| 4 | 11:49:21 | 11:49:24 | 3ç§’ | 3å¹´ | 1.0ç§’ |
| 5 | 11:49:24 | 11:49:27 | 3ç§’ | 3å¹´ | 1.0ç§’ |
| 6 | 11:49:27 | 11:49:33 | 6ç§’ | 3å¹´ | 2.0ç§’ |
| 7 | 11:49:33 | 11:49:37 | 4ç§’ | 3å¹´ | 1.3ç§’ |
| 8 | 11:49:37 | 11:49:42 | 5ç§’ | 3å¹´ | 1.7ç§’ |
| 9 | 11:49:42 | 11:49:44 | 2ç§’ | 3å¹´ | 0.7ç§’ |

**æ€»è®¡**: 32ç§’ (9ä¸ªå­é—®é¢˜ Ã— å¹³å‡3.6ç§’)
**å¹³å‡**: æ¯å¹´1.2ç§’ (32ç§’ / 9å­é—®é¢˜ / 3å¹´)

---

## 2. æ ¸å¿ƒå‘ç°

### ğŸ” å‘ç°1: `search_multi_year` æ˜¯ä¸²è¡Œforå¾ªç¯

**ä»£ç ä½ç½®**: `src/vectordb/pinecone_retriever.py:148-189`

```python
def search_multi_year(self, query_vector, years, limit_per_year, other_filters=None):
    """å¤šå¹´ä»½æ£€ç´¢"""
    all_results = []

    # âš ï¸ å…³é”®: è¿™æ˜¯ä¸€ä¸ªä¸²è¡Œforå¾ªç¯!
    for year in years:  # å¯¹äºQ1æ˜¯10æ¬¡å¾ªç¯,Q5æ˜¯3æ¬¡å¾ªç¯
        # 1. æ„å»ºå¹´ä»½è¿‡æ»¤å™¨
        year_filter = {'year': {'$eq': str(year)}}

        # 2. åˆå¹¶å…¶ä»–è¿‡æ»¤æ¡ä»¶
        if converted_other_filters:
            combined_filter = {'$and': [year_filter, converted_other_filters]}
        else:
            combined_filter = year_filter

        # 3. è°ƒç”¨PineconeæŸ¥è¯¢ (ç½‘ç»œè¯·æ±‚,é˜»å¡)
        results = self.index.query(
            vector=query_vector,
            top_k=limit_per_year,  # æ¯å¹´5ä¸ª
            filter=combined_filter,
            include_metadata=True
        )

        # 4. å¤„ç†ç»“æœ
        year_results = [...]
        all_results.extend(year_results)

    return all_results
```

**å…³é”®ç‰¹å¾**:
1. **ä¸²è¡Œæ‰§è¡Œ**: é€å¹´æŸ¥è¯¢,ç­‰å¾…æ¯æ¬¡Pineconeå“åº”åæ‰è¿›è¡Œä¸‹ä¸€å¹´
2. **ç½‘ç»œé˜»å¡**: æ¯æ¬¡`index.query`éƒ½æ˜¯HTTPè¯·æ±‚,è€—æ—¶å–å†³äºç½‘ç»œå»¶è¿Ÿ
3. **çº¿æ€§å¢é•¿**: å¹´ä»½æ•°ç¿»å€,æ€»è€—æ—¶ä¹Ÿç¿»å€

---

### ğŸ” å‘ç°2: Q1å’ŒQ5çš„æ€§èƒ½å·®å¼‚å®Œå…¨ç¬¦åˆçº¿æ€§å…³ç³»

**æ•°å­¦éªŒè¯**:

```
Q5: 3å¹´ Ã— 9å­é—®é¢˜ = 27æ¬¡PineconeæŸ¥è¯¢, è€—æ—¶32ç§’
â†’ å¹³å‡æ¯æ¬¡æŸ¥è¯¢: 32ç§’ / 27 = 1.2ç§’

Q1: 10å¹´ Ã— 10å­é—®é¢˜ = 100æ¬¡PineconeæŸ¥è¯¢
â†’ é¢„æµ‹è€—æ—¶: 100 Ã— 1.2ç§’ = 120ç§’

å®é™…Q1è€—æ—¶: 816ç§’
å·®è·: 816 - 120 = 696ç§’ (é¢å¤–æŸè€—)
```

**ä¸ºä»€ä¹ˆQ1å®é™…æ›´æ…¢?**

è®©æˆ‘é‡æ–°è®¡ç®—Q1çš„**å‰7ä¸ªå­é—®é¢˜**(æ…¢)å’Œ**å3ä¸ªå­é—®é¢˜**(å¿«):

```
å­é—®é¢˜1-7: å¹³å‡91ç§’/å­é—®é¢˜ â†’ æ¯å¹´9.1ç§’
å­é—®é¢˜8-10: å¹³å‡13ç§’/å­é—®é¢˜ â†’ æ¯å¹´1.3ç§’

å·®å¼‚: 7å€!
```

**æ¨æµ‹**: å­é—®é¢˜8-10å¯èƒ½å‘½ä¸­äº†æŸç§ç¼“å­˜(Pineconeå†…éƒ¨ç¼“å­˜æˆ–CDNç¼“å­˜)

---

### ğŸ” å‘ç°3: æ¯æ¬¡PineconeæŸ¥è¯¢çš„å®é™…è€—æ—¶

**Q5çš„å…¸å‹è¡¨ç°** (ç¨³å®š,æ— ç¼“å­˜å¹²æ‰°):
- å¹³å‡æ¯æ¬¡æŸ¥è¯¢: **1.2ç§’**
- èŒƒå›´: 0.3ç§’ - 2.0ç§’

**Q1çš„å…¸å‹è¡¨ç°** (å‰7ä¸ªå­é—®é¢˜):
- å¹³å‡æ¯æ¬¡æŸ¥è¯¢: **9-14ç§’**
- èŒƒå›´: 8.2ç§’ - 14.9ç§’

**ä¸ºä»€ä¹ˆQ1æ…¢10å€?**

å¯èƒ½åŸå› :
1. **Pineconeå†·å¯åŠ¨**: 10å¹´æ•°æ®å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒåˆ†ç‰‡,é¦–æ¬¡æŸ¥è¯¢éœ€è¦åŠ è½½ç´¢å¼•
2. **ç½‘ç»œæ³¢åŠ¨**: æµ‹è¯•æ—¶é—´åœ¨11:20-11:34,å¯èƒ½ç½‘ç»œæ‹¥å µ
3. **Pineconeé™æµ**: é¢‘ç¹æŸ¥è¯¢è§¦å‘rate limiting
4. **æ•°æ®é‡å·®å¼‚**: 2015-2024å¹´æ•°æ®åˆ†å¸ƒä¸å‡,æŸäº›å¹´ä»½æ–‡æ¡£å¤š,æŸ¥è¯¢æ…¢

---

## 3. ä¸ºä»€ä¹ˆQ8-Q10çªç„¶å˜å¿«?

**ç°è±¡**:
- Q1-Q7: å¹³å‡91ç§’/å­é—®é¢˜
- Q8-Q10: å¹³å‡13ç§’/å­é—®é¢˜ (å¿«7å€!)

**æ¨æµ‹**:
1. **Pineconeç¼“å­˜é¢„çƒ­**: å‰7ä¸ªå­é—®é¢˜å·²ç»æŸ¥è¯¢äº†2015-2024æ‰€æœ‰å¹´ä»½,Pineconeå†…éƒ¨ç¼“å­˜å·²é¢„çƒ­
2. **ç›¸åŒquery pattern**: Q8-Q10çš„queryå¯èƒ½ä¸Q1-Q7é«˜åº¦ç›¸ä¼¼,Pineconeè¯†åˆ«å¹¶ç¼“å­˜
3. **åˆ†ç‰‡å·²åŠ è½½**: Pineconeçš„ç´¢å¼•åˆ†ç‰‡å·²å…¨éƒ¨åŠ è½½åˆ°å†…å­˜

**è¯æ®**:
- Q8-Q10çš„æ¯å¹´è€—æ—¶(1.2-1.5ç§’)ä¸Q5ä¸€è‡´(1.2ç§’)
- è¯´æ˜Pineconeå•æ¬¡æŸ¥è¯¢çš„ç†æƒ³è€—æ—¶å°±æ˜¯1-2ç§’

---

## 4. æ ¹æœ¬åŸå› æ€»ç»“

### Q1æ…¢çš„æ ¹å› :

```
ä¸²è¡Œforå¾ªç¯ (10å¹´)
Ã—
10ä¸ªå­é—®é¢˜
Ã—
Pineconeå†·å¯åŠ¨/ç½‘ç»œæ³¢åŠ¨ (~10ç§’/æŸ¥è¯¢)
=
816ç§’
```

### Q5å¿«çš„æ ¹å› :

```
ä¸²è¡Œforå¾ªç¯ (3å¹´)
Ã—
9ä¸ªå­é—®é¢˜
Ã—
Pineconeçƒ­ç¼“å­˜/ç¨³å®šç½‘ç»œ (~1.2ç§’/æŸ¥è¯¢)
=
32ç§’
```

### æ€§èƒ½å…¬å¼:

```
æ€»è€—æ—¶ = å­é—®é¢˜æ•° Ã— å¹´ä»½æ•° Ã— å•æ¬¡æŸ¥è¯¢è€—æ—¶

Q1: 10 Ã— 10 Ã— 8.16ç§’ = 816ç§’
Q5: 9 Ã— 3 Ã— 1.18ç§’ = 32ç§’
```

**å…³é”®å˜é‡**: `å•æ¬¡æŸ¥è¯¢è€—æ—¶` å—Pineconeç¼“å­˜å’Œç½‘ç»œçŠ¶æ€å½±å“,æ³¢åŠ¨èŒƒå›´0.3ç§’-15ç§’

---

## 5. å¹¶è¡ŒåŒ–ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆA: å¹¶è¡ŒåŒ–å¹´ä»½æŸ¥è¯¢ (å­é—®é¢˜å†…å¹¶è¡Œ)

**å½“å‰**:
```python
for year in years:  # ä¸²è¡Œ,10å¹´éœ€è¦10Ã—8ç§’=80ç§’
    results = pinecone.query(...)
```

**ä¼˜åŒ–å**:
```python
import concurrent.futures

def query_year(year):
    return pinecone.query(vector, filter={'year': year}, top_k=5)

with ThreadPoolExecutor(max_workers=10) as executor:
    futures = [executor.submit(query_year, y) for y in years]
    results = [f.result() for f in futures]
# 10å¹´å¹¶è¡ŒæŸ¥è¯¢,æ€»è€—æ—¶ â‰ˆ max(å•æ¬¡æŸ¥è¯¢) â‰ˆ 8-10ç§’
```

**æ”¶ç›Š**:
- Q1å•ä¸ªå­é—®é¢˜: 80ç§’ â†’ **8-10ç§’** (èŠ‚çœ70ç§’)
- Q1æ€»è€—æ—¶: 816ç§’ â†’ **80-100ç§’** (èŠ‚çœ716ç§’ / 12åˆ†é’Ÿ)

---

### æ–¹æ¡ˆB: å¹¶è¡ŒåŒ–å­é—®é¢˜æŸ¥è¯¢ (å­é—®é¢˜é—´å¹¶è¡Œ)

**å½“å‰**:
```python
for sub_q in sub_questions:  # ä¸²è¡Œ,10ä¸ªå­é—®é¢˜éœ€è¦10Ã—80ç§’=800ç§’
    embedding = embed(sub_q)
    results = search_multi_year(embedding, years)
```

**ä¼˜åŒ–å**:
```python
# 1. æ‰¹é‡embedding (GPUå¹¶è¡Œ)
embeddings = embed_batch(sub_questions)  # 10ä¸ªquery,1-2ç§’

# 2. å¹¶è¡Œæ£€ç´¢æ‰€æœ‰å­é—®é¢˜
def retrieve_subq(embedding, years):
    return search_multi_year(embedding, years)

with ThreadPoolExecutor(max_workers=10) as executor:
    futures = [executor.submit(retrieve_subq, emb, years) for emb in embeddings]
    results = [f.result() for f in futures]
```

**æ”¶ç›Š**:
- å¦‚æœåªå¹¶è¡Œå­é—®é¢˜(ä¸å¹¶è¡Œå¹´ä»½): å—é™äºå•ä¸ªå­é—®é¢˜è€—æ—¶(80ç§’),æ€»è€—æ—¶ä»éœ€80ç§’
- **éœ€è¦åŒæ—¶åº”ç”¨æ–¹æ¡ˆAå’ŒBæ‰èƒ½æœ€å¤§åŒ–æ”¶ç›Š**

---

### æ–¹æ¡ˆC: åŒå±‚å¹¶è¡Œ (æœ€ä¼˜æ–¹æ¡ˆ) â­â­â­

**ç»“åˆæ–¹æ¡ˆA+B**:
```python
# 1. æ‰¹é‡embedding (GPUå¹¶è¡Œ)
embeddings = embed_batch(sub_questions)  # 10ä¸ªquery,1-2ç§’

# 2. å¹¶è¡Œæ£€ç´¢æ‰€æœ‰å­é—®é¢˜,æ¯ä¸ªå­é—®é¢˜å†…éƒ¨å¹¶è¡ŒæŸ¥è¯¢å¹´ä»½
def retrieve_subq_parallel_years(embedding, years):
    # å†…å±‚å¹¶è¡Œ: å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å¹´ä»½
    with ThreadPoolExecutor(max_workers=len(years)) as executor:
        futures = [executor.submit(query_year, embedding, y) for y in years]
        year_results = [f.result() for f in futures]
    return merge_results(year_results)

# å¤–å±‚å¹¶è¡Œ: å¹¶è¡Œå¤„ç†æ‰€æœ‰å­é—®é¢˜
with ThreadPoolExecutor(max_workers=10) as executor:
    futures = [executor.submit(retrieve_subq_parallel_years, emb, years)
               for emb in embeddings]
    results = [f.result() for f in futures]
```

**æ”¶ç›Š**:
- Q1: 816ç§’ â†’ **10-15ç§’** (èŠ‚çœ801ç§’ / 13.4åˆ†é’Ÿ)
- Q5: 32ç§’ â†’ **2-3ç§’** (èŠ‚çœ29ç§’)

**ç†è®ºæœ€ä¼˜è€—æ—¶**:
```
æ‰¹é‡embedding: 1-2ç§’
å¹¶è¡Œæ£€ç´¢(10å­é—®é¢˜ Ã— 10å¹´,å…±100æ¬¡æŸ¥è¯¢åŒæ—¶è¿›è¡Œ): 8-10ç§’
åˆå¹¶ç»“æœ: 1-2ç§’
æ€»è®¡: 10-14ç§’
```

---

## 6. å¹¶è¡ŒåŒ–å¯è¡Œæ€§è¯„ä¼°

### âœ… æŠ€æœ¯å¯è¡Œæ€§: éå¸¸é«˜

#### 1. Pythonå¹¶å‘æ”¯æŒ
```python
import concurrent.futures  # æ ‡å‡†åº“,æ— éœ€é¢å¤–ä¾èµ–
import asyncio  # å¯é€‰,æ”¯æŒå¼‚æ­¥IO

# ThreadPoolExecutor: é€‚åˆIOå¯†é›†å‹(Pineconeç½‘ç»œè¯·æ±‚)
# ProcessPoolExecutor: é€‚åˆCPUå¯†é›†å‹(embeddingè®¡ç®—)
```

#### 2. Pinecone APIé™åˆ¶
**å®˜æ–¹æ–‡æ¡£** (Pinecone Serverless):
- **å¹¶å‘é™åˆ¶**: æ— ç¡¬æ€§é™åˆ¶,æ¨è100-200å¹¶å‘
- **é€Ÿç‡é™åˆ¶**:
  - å…è´¹ç‰ˆ: 100 queries/second
  - Proç‰ˆ: 1000 queries/second
- **æˆ‘ä»¬çš„åœºæ™¯**: æœ€å¤š100å¹¶å‘(10å­é—®é¢˜Ã—10å¹´),å®Œå…¨åœ¨å®‰å…¨èŒƒå›´å†…

#### 3. ç¡¬ä»¶èµ„æºéœ€æ±‚
| èµ„æº | éœ€æ±‚ | è¯´æ˜ |
|-----|------|------|
| CPU | 2æ ¸+ | ThreadPoolä¸»è¦ä¾èµ–IO,CPUæ¶ˆè€—ä½ |
| å†…å­˜ | 2GB+ | æ¯ä¸ªçº¿ç¨‹~20MB,10çº¿ç¨‹~200MB |
| ç½‘ç»œ | ç¨³å®šè¿æ¥ | å¸¦å®½éœ€æ±‚ä½(æ¯æ¬¡æŸ¥è¯¢å‡ KB),ä½†éœ€è¦ä½å»¶è¿Ÿ |
| GPU | å¯é€‰ | ä»…ç”¨äºæ‰¹é‡embedding,éå¿…éœ€ |

**ç»“è®º**: **æ™®é€šäº‘æœåŠ¡å™¨å³å¯**(å¦‚2C4G),æ— éœ€ç‰¹æ®Šç¡¬ä»¶

---

### âœ… äº‘ç«¯éƒ¨ç½²æ”¯æŒ: å®Œå…¨æ”¯æŒ

#### æ”¯æŒçš„äº‘å¹³å°

| å¹³å° | æ”¯æŒæƒ…å†µ | æ¨èé…ç½® |
|------|---------|---------|
| **AWS Lambda** | âœ… æ”¯æŒ | 1024MBå†…å­˜,60ç§’è¶…æ—¶ |
| **GCP Cloud Run** | âœ… æ”¯æŒ | 2GBå†…å­˜,300ç§’è¶…æ—¶ |
| **Azure Functions** | âœ… æ”¯æŒ | Premium Plan |
| **é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—** | âœ… æ”¯æŒ | 2GBå†…å­˜ |
| **è…¾è®¯äº‘SCF** | âœ… æ”¯æŒ | 2GBå†…å­˜ |
| **Dockerå®¹å™¨** | âœ… å®Œå…¨æ”¯æŒ | ä»»æ„äº‘å¹³å° |
| **Kubernetes** | âœ… å®Œå…¨æ”¯æŒ | ä»»æ„äº‘å¹³å° |

**å…³é”®è€ƒè™‘**:
1. **è¶…æ—¶é™åˆ¶**: ä¼˜åŒ–å10-15ç§’,æ‰€æœ‰Serverlesså¹³å°éƒ½æ”¯æŒ
2. **å¹¶å‘é™åˆ¶**: ThreadPoolåœ¨å•ä¸ªå‡½æ•°å®ä¾‹å†…è¿è¡Œ,ä¸å—å¹³å°å¹¶å‘é™åˆ¶
3. **å†·å¯åŠ¨**: ä¼˜åŒ–åè€—æ—¶çŸ­,å†·å¯åŠ¨å½±å“ç›¸å¯¹è¾ƒå°

---

### âœ… ä»£ç æ”¹åŠ¨: å°

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**:
1. `src/vectordb/pinecone_retriever.py` - æ·»åŠ `search_multi_year_parallel`æ–¹æ³•
2. `src/graph/nodes/retrieve_pinecone.py` - æ·»åŠ æ‰¹é‡embeddingæ”¯æŒ

**é¢„è®¡å·¥ä½œé‡**: 2-4å°æ—¶

**ç¤ºä¾‹ä»£ç **:
```python
# src/vectordb/pinecone_retriever.py

def search_multi_year_parallel(self, query_vector, years, limit_per_year, other_filters=None):
    """
    å¹¶è¡Œå¤šå¹´ä»½æ£€ç´¢(ä¼˜åŒ–ç‰ˆ)

    ä½¿ç”¨ThreadPoolExecutorå¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å¹´ä»½,å¤§å¹…æå‡æ€§èƒ½
    """
    import concurrent.futures

    def query_single_year(year):
        """æŸ¥è¯¢å•ä¸ªå¹´ä»½"""
        year_filter = {'year': {'$eq': str(year)}}

        if other_filters:
            combined_filter = {'$and': [year_filter, other_filters]}
        else:
            combined_filter = year_filter

        try:
            results = self.index.query(
                vector=query_vector,
                top_k=limit_per_year,
                filter=combined_filter,
                include_metadata=True
            )

            return [(match.id, match.score, match.metadata) for match in results.matches]
        except Exception as e:
            logger.warning(f"[PineconeRetriever] {year}å¹´æ£€ç´¢å¤±è´¥: {e}")
            return []

    # å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å¹´ä»½
    max_workers = min(len(years), 20)  # é™åˆ¶æœ€å¤§å¹¶å‘æ•°

    with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:
        # æäº¤æ‰€æœ‰ä»»åŠ¡
        future_to_year = {executor.submit(query_single_year, year): year
                          for year in years}

        # æ”¶é›†ç»“æœ
        all_results = []
        year_distribution = {}

        for future in concurrent.futures.as_completed(future_to_year):
            year = future_to_year[future]
            try:
                year_results = future.result()
                year_distribution[year] = len(year_results)
                all_results.extend(year_results)
            except Exception as e:
                logger.error(f"[PineconeRetriever] {year}å¹´æ£€ç´¢å¼‚å¸¸: {e}")
                year_distribution[year] = 0

    # æŒ‰ç›¸ä¼¼åº¦æ’åº
    all_results.sort(key=lambda x: x[1], reverse=True)

    logger.info(f"[PineconeRetriever] å¹¶è¡Œå¤šå¹´ä»½æ£€ç´¢å®Œæˆ: {len(all_results)}ä¸ªæ–‡æ¡£, {year_distribution}")

    return all_results
```

---

## 7. é£é™©è¯„ä¼°

### ä½é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|--------|------|---------|
| Pineconeé™æµ | ä½ | ä¸­ | æ§åˆ¶max_workersâ‰¤20,æ·»åŠ é‡è¯•é€»è¾‘ |
| ç»“æœä¸ä¸€è‡´ | æä½ | é«˜ | å¹¶è¡Œä¸æ”¹å˜æŸ¥è¯¢é€»è¾‘,ç»“æœé¡ºåºå¯èƒ½ä¸åŒä½†å†…å®¹ç›¸åŒ |
| å†…å­˜æº¢å‡º | æä½ | ä¸­ | æ¯ä¸ªçº¿ç¨‹å†…å­˜æ¶ˆè€—ä½,10çº¿ç¨‹<200MB |
| äº‘å¹³å°é™åˆ¶ | ä½ | ä½ | æ‰€æœ‰ä¸»æµå¹³å°éƒ½æ”¯æŒThreadPool |

**æ€»ä½“é£é™©**: **ä½**,ä¸”å¯æ§

---

## 8. å®æ–½å»ºè®®

### Phase 1: éªŒè¯æ–¹æ¡ˆ (1å¤©)

1. åˆ›å»º`search_multi_year_parallel`æ–¹æ³•
2. å¯¹æ¯”ä¸²è¡Œvså¹¶è¡Œçš„ç»“æœä¸€è‡´æ€§
3. æµ‹è¯•Q1æ€§èƒ½æå‡

### Phase 2: å®Œæ•´ä¼˜åŒ– (2-3å¤©)

1. å®æ–½æ–¹æ¡ˆC(åŒå±‚å¹¶è¡Œ)
2. æ·»åŠ æ‰¹é‡embedding
3. å…¨é¢æµ‹è¯•7ä¸ªé—®é¢˜

### Phase 3: äº‘ç«¯éƒ¨ç½² (1-2å¤©)

1. Dockerå®¹å™¨åŒ–
2. äº‘å¹³å°éƒ¨ç½²æµ‹è¯•
3. æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜

---

## 9. æ€»ç»“

### æ ¸å¿ƒç­”æ¡ˆ

**Q: ä¸ºä»€ä¹ˆQ5(9ä¸ªå­é—®é¢˜)åªç”¨32ç§’,è€ŒQ1(10ä¸ªå­é—®é¢˜)ç”¨äº†816ç§’?**

**A: å› ä¸ºQ1æ¶‰åŠ10å¹´(10Ã—),Q5åªæ¶‰åŠ3å¹´(3Ã—),è€Œ`search_multi_year`æ˜¯ä¸²è¡Œforå¾ªç¯,å¯¼è‡´:**
```
Q1: 10å­é—®é¢˜ Ã— 10å¹´ Ã— 8.16ç§’/æŸ¥è¯¢ = 816ç§’
Q5: 9å­é—®é¢˜ Ã— 3å¹´ Ã— 1.18ç§’/æŸ¥è¯¢ = 32ç§’
å·®è·: 25å€ âœ… ç¬¦åˆè§‚å¯Ÿ
```

### ä¼˜åŒ–æ–¹æ¡ˆ

**å¹¶è¡ŒåŒ–Retrieve**:
- âœ… æŠ€æœ¯å¯è¡Œæ€§: éå¸¸é«˜
- âœ… ç¡¬ä»¶éœ€æ±‚: ä½ (2C4Gæ™®é€šæœåŠ¡å™¨å³å¯)
- âœ… äº‘ç«¯æ”¯æŒ: æ‰€æœ‰ä¸»æµå¹³å°
- âœ… ä»£ç æ”¹åŠ¨: å° (2-4å°æ—¶)
- âœ… é£é™©: ä½ä¸”å¯æ§
- âœ… æ”¶ç›Š: **Q1ä»19åˆ†é’Ÿä¼˜åŒ–åˆ°10-15ç§’** (èŠ‚çœ95%+)

### å»ºè®®

**ç«‹å³å®æ–½å¹¶è¡ŒåŒ–ä¼˜åŒ–**,è¿™æ˜¯æ€§èƒ½æå‡æœ€å¤§çš„single change,ä¸”é£é™©æä½!
